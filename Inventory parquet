
-- CREATE TABLE TO LOAD PARQUET DATA
CREATE OR REPLACE TABLE PRACTICEDB.SANJAY_SCHEMA.INVENTORY_PARQUET (
    	ID NUMBER(38,0),
PRODUCT_NAME VARCHAR(1000),
QTY_AVAILABLE NUMBER(3,0)
);



-- CREATE FILE FORMAT TO INFORM SNOWFLAKE THAT WHICH FORMAT OF THE FILE TO EXPECT 
CREATE OR REPLACE FILE FORMAT PRACTICEDB.SANJAY_SCHEMA.INVENTORY_PARQUET_FORMAT
TYPE = PARQUET;
  
-- CREATE STAGE OBJECT TO LET SNOWFLAKE KNOW FROM WHERE TO PICK THE FILES
CREATE OR REPLACE STAGE PRACTICEDB.SANJAY_SCHEMA.SANJAY_STAGE
STORAGE_INTEGRATION = S3_INT
URL = 's3://wav-training/snowflake/Inventory.parquet '
FILE_FORMAT = INVENTORY_PARQUET_FORMAT;

-- TAKE A LOOK AT THE DATA PRIOR TO LOADING INTO THE TABLES
SELECT * FROM @PRACTICEDB.SANJAY_SCHEMA.SANJAY_STAGE;

COPY INTO PRACTICEDB.SANJAY_SCHEMA.INVENTORY_PARQUET
FROM (select $1:"_COL_0",
              $1:"_COL_1",
              $1:"_COL_2"
      FROM @PRACTICEDB.SANJAY_SCHEMA.SANJAY_STAGE
);


SELECT * FROM (select $1:"_COL_0" as ID, 

              $1:"_COL_1" as Name, 

              $1:"_COL_2" as Qty

      FROM @PRACTICEDB.SANJAY_SCHEMA.SANJAY_STAGE

) 

WHERE ID < 5; 



create or replace stream PRACTICEDB.SANJAY_SCHEMA.SANJAY_STREAM ON TABLE PRACTICEDB.SANJAY_SCHEMA.INVENTORY_PARQUET;

SELECT * FROM PRACTICEDB.SANJAY_SCHEMA.SANJAY_STREAM;

SELECT * FROM PRACTICEDB.SANJAY_SCHEMA.INVENTORY_PARQUET;

UPDATE INVENTORY_PARQUET SET QTY_AVAILABLE = 5 WHERE ID = 3;

CREATE TASK Task1 

  WAREHOUSE = Load_WH 

  SCHEDULE = '60 minute' 

AS 

  INSERT INTO PRACTICEDB.SANJAY_SCHEMA.INVENTORY_PARQUET VALUES
  (21, '5 STAR', 100),
  (22, 'CANDYMAN', 100),
  (23, 'BOURBON', 100);
  
  
  EXECUTE TASK Task1;
  
  SELECT * FROM PRACTICEDB.SANJAY_SCHEMA.SANJAY_STREAM;

SELECT * FROM PRACTICEDB.SANJAY_SCHEMA.INVENTORY_PARQUET;
